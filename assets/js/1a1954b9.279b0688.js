"use strict";(globalThis.webpackChunkphysical_ai_textbook=globalThis.webpackChunkphysical_ai_textbook||[]).push([[6015],{52:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>a,contentTitle:()=>o,default:()=>p,frontMatter:()=>l,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"module-01-ros2/nodes-topics","title":"Chapter 2: Nodes and Topics","description":"Deep Dive into Nodes","source":"@site/docs/module-01-ros2/02-nodes-topics.md","sourceDirName":"module-01-ros2","slug":"/module-01-ros2/nodes-topics","permalink":"/physical-ai-textbook/docs/module-01-ros2/nodes-topics","draft":false,"unlisted":false,"editUrl":"https://github.com/Zeenat-Somroo911/physical-ai-textbook/edit/main/docs/module-01-ros2/02-nodes-topics.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Chapter 1: Introduction to ROS 2","permalink":"/physical-ai-textbook/docs/module-01-ros2/introduction"},"next":{"title":"Chapter 3: Services and Actions","permalink":"/physical-ai-textbook/docs/module-01-ros2/services-actions"}}');var i=n(4848),t=n(8453);const l={sidebar_position:2},o="Chapter 2: Nodes and Topics",a={},c=[{value:"Deep Dive into Nodes",id:"deep-dive-into-nodes",level:2},{value:"What is a Node?",id:"what-is-a-node",level:3},{value:"Node Lifecycle",id:"node-lifecycle",level:3},{value:"Creating a Node",id:"creating-a-node",level:3},{value:"Node Namespaces",id:"node-namespaces",level:3},{value:"Node Logging",id:"node-logging",level:3},{value:"Publisher-Subscriber Pattern",id:"publisher-subscriber-pattern",level:2},{value:"Architecture Diagram",id:"architecture-diagram",level:3},{value:"Complete Code Example 1: Simple Publisher",id:"complete-code-example-1-simple-publisher",level:2},{value:"Complete Code Example 2: Simple Subscriber",id:"complete-code-example-2-simple-subscriber",level:2},{value:"Complete Code Example 3: Bidirectional Communication",id:"complete-code-example-3-bidirectional-communication",level:2},{value:"Topic Inspection Commands",id:"topic-inspection-commands",level:2},{value:"List All Topics",id:"list-all-topics",level:3},{value:"Get Topic Information",id:"get-topic-information",level:3},{value:"View Topic Data",id:"view-topic-data",level:3},{value:"Publish to Topic",id:"publish-to-topic",level:3},{value:"Get Topic Type",id:"get-topic-type",level:3},{value:"Monitor Topic Rate",id:"monitor-topic-rate",level:3},{value:"View Topic Bandwidth",id:"view-topic-bandwidth",level:3},{value:"Quality of Service (QoS) Profiles",id:"quality-of-service-qos-profiles",level:2},{value:"QoS Settings",id:"qos-settings",level:3},{value:"Common QoS Profiles",id:"common-qos-profiles",level:3},{value:"QoS Compatibility",id:"qos-compatibility",level:3},{value:"Example: QoS Configuration",id:"example-qos-configuration",level:3},{value:"Advanced Topics",id:"advanced-topics",level:2},{value:"Remapping Topics",id:"remapping-topics",level:3},{value:"Namespaces",id:"namespaces",level:3},{value:"Message Filtering",id:"message-filtering",level:3},{value:"Common Errors and Solutions",id:"common-errors-and-solutions",level:2},{value:"Error 1: &quot;No subscribers connected&quot;",id:"error-1-no-subscribers-connected",level:3},{value:"Error 2: &quot;QoS incompatibility&quot;",id:"error-2-qos-incompatibility",level:3},{value:"Error 3: &quot;Message queue full&quot;",id:"error-3-message-queue-full",level:3},{value:"Error 4: &quot;Topic name typo&quot;",id:"error-4-topic-name-typo",level:3},{value:"Student Exercises",id:"student-exercises",level:2},{value:"Exercise 1: Multi-Sensor Publisher",id:"exercise-1-multi-sensor-publisher",level:3},{value:"Exercise 2: Data Logger",id:"exercise-2-data-logger",level:3},{value:"Exercise 3: Topic Relay",id:"exercise-3-topic-relay",level:3},{value:"Exercise 4: Message Statistics",id:"exercise-4-message-statistics",level:3},{value:"Exercise 5: QoS Experiment",id:"exercise-5-qos-experiment",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.header,{children:(0,i.jsx)(r.h1,{id:"chapter-2-nodes-and-topics",children:"Chapter 2: Nodes and Topics"})}),"\n",(0,i.jsx)(r.h2,{id:"deep-dive-into-nodes",children:"Deep Dive into Nodes"}),"\n",(0,i.jsx)(r.p,{children:"Nodes are the fundamental building blocks of ROS 2 applications. Understanding nodes is crucial for building robust robotic systems."}),"\n",(0,i.jsx)(r.h3,{id:"what-is-a-node",children:"What is a Node?"}),"\n",(0,i.jsxs)(r.p,{children:["A ",(0,i.jsx)(r.strong,{children:"node"})," is an executable process that performs a specific task in a robot system. Each node:"]}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Operates independently"}),"\n",(0,i.jsx)(r.li,{children:"Communicates with other nodes via topics, services, or actions"}),"\n",(0,i.jsx)(r.li,{children:"Has a unique name in the ROS 2 graph"}),"\n",(0,i.jsx)(r.li,{children:"Can be written in Python, C++, or other supported languages"}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"node-lifecycle",children:"Node Lifecycle"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-mermaid",children:"stateDiagram-v2\r\n    [*] --\x3e Unconfigured\r\n    Unconfigured --\x3e Inactive: configure()\r\n    Inactive --\x3e Active: activate()\r\n    Active --\x3e Inactive: deactivate()\r\n    Inactive --\x3e Unconfigured: cleanup()\r\n    Unconfigured --\x3e [*]: shutdown()\r\n    \r\n    note right of Active\r\n        Node can publish/subscribe\r\n        Process callbacks\r\n    end note\n"})}),"\n",(0,i.jsx)(r.h3,{id:"creating-a-node",children:"Creating a Node"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:"import rclpy\r\nfrom rclpy.node import Node\r\n\r\nclass MyNode(Node):\r\n    def __init__(self):\r\n        super().__init__('my_node_name')\r\n        # Node initialization code here\n"})}),"\n",(0,i.jsx)(r.h3,{id:"node-namespaces",children:"Node Namespaces"}),"\n",(0,i.jsx)(r.p,{children:"Organize nodes using namespaces:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:"# Global namespace\r\nsuper().__init__('my_node')\r\n\r\n# Namespaced\r\nsuper().__init__('robot1/my_node')\r\nsuper().__init__('robot1/sensors/camera_node')\n"})}),"\n",(0,i.jsx)(r.h3,{id:"node-logging",children:"Node Logging"}),"\n",(0,i.jsx)(r.p,{children:"ROS 2 provides logging levels:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:"self.get_logger().debug('Debug message')\r\nself.get_logger().info('Info message')\r\nself.get_logger().warn('Warning message')\r\nself.get_logger().error('Error message')\r\nself.get_logger().fatal('Fatal message')\n"})}),"\n",(0,i.jsx)(r.h2,{id:"publisher-subscriber-pattern",children:"Publisher-Subscriber Pattern"}),"\n",(0,i.jsx)(r.p,{children:"The publish-subscribe (pub-sub) pattern is the most common communication method in ROS 2. It provides:"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Decoupling"}),": Publishers and subscribers don't need to know about each other"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Scalability"}),": Multiple subscribers can receive the same message"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Flexibility"}),": Easy to add/remove nodes"]}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"architecture-diagram",children:"Architecture Diagram"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-mermaid",children:"graph LR\r\n    A[Publisher Node] --\x3e|Publishes| B[Topic: /sensor_data]\r\n    B --\x3e|Subscribes| C[Subscriber Node 1]\r\n    B --\x3e|Subscribes| D[Subscriber Node 2]\r\n    B --\x3e|Subscribes| E[Subscriber Node 3]\r\n    \r\n    style A fill:#e1f5ff\r\n    style B fill:#b3e5fc\r\n    style C fill:#c8e6c9\r\n    style D fill:#c8e6c9\r\n    style E fill:#c8e6c9\n"})}),"\n",(0,i.jsx)(r.h2,{id:"complete-code-example-1-simple-publisher",children:"Complete Code Example 1: Simple Publisher"}),"\n",(0,i.jsx)(r.p,{children:"Let's create a temperature sensor publisher:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:'#!/usr/bin/env python3\r\n"""\r\nTemperature Sensor Publisher\r\n\r\nPublishes simulated temperature readings.\r\n"""\r\n\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom std_msgs.msg import Float32\r\nimport random\r\nimport math\r\n\r\n\r\nclass TemperaturePublisher(Node):\r\n    """Publishes temperature sensor data."""\r\n    \r\n    def __init__(self):\r\n        super().__init__(\'temperature_publisher\')\r\n        \r\n        # Create publisher\r\n        self.publisher_ = self.create_publisher(\r\n            Float32,\r\n            \'temperature\',\r\n            10\r\n        )\r\n        \r\n        # Timer: publish every 0.5 seconds\r\n        timer_period = 0.5\r\n        self.timer = self.create_timer(timer_period, self.timer_callback)\r\n        \r\n        # Simulate temperature (20-25\xb0C with noise)\r\n        self.base_temp = 22.5\r\n        self.time = 0.0\r\n        \r\n        self.get_logger().info(\'Temperature publisher started\')\r\n    \r\n    def timer_callback(self):\r\n        """Publish temperature reading."""\r\n        msg = Float32()\r\n        \r\n        # Simulate temperature with sine wave + noise\r\n        self.time += 0.5\r\n        temperature = self.base_temp + \\\r\n                      2.0 * math.sin(self.time * 0.1) + \\\r\n                      random.gauss(0, 0.5)\r\n        \r\n        msg.data = temperature\r\n        \r\n        self.publisher_.publish(msg)\r\n        self.get_logger().info(f\'Published temperature: {temperature:.2f}\xb0C\')\r\n\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = TemperaturePublisher()\r\n    \r\n    try:\r\n        rclpy.spin(node)\r\n    except KeyboardInterrupt:\r\n        node.get_logger().info(\'Shutting down...\')\r\n    finally:\r\n        node.destroy_node()\r\n        rclpy.shutdown()\r\n\r\n\r\nif __name__ == \'__main__\':\r\n    main()\n'})}),"\n",(0,i.jsx)(r.h2,{id:"complete-code-example-2-simple-subscriber",children:"Complete Code Example 2: Simple Subscriber"}),"\n",(0,i.jsx)(r.p,{children:"Now let's create a subscriber that processes temperature data:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:"#!/usr/bin/env python3\r\n\"\"\"\r\nTemperature Monitor Subscriber\r\n\r\nSubscribes to temperature data and monitors for high temperatures.\r\n\"\"\"\r\n\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom std_msgs.msg import Float32\r\n\r\n\r\nclass TemperatureMonitor(Node):\r\n    \"\"\"Monitors temperature and alerts if too high.\"\"\"\r\n    \r\n    def __init__(self):\r\n        super().__init__('temperature_monitor')\r\n        \r\n        # Create subscriber\r\n        self.subscription = self.create_subscription(\r\n            Float32,\r\n            'temperature',\r\n            self.temperature_callback,\r\n            10  # Queue size\r\n        )\r\n        \r\n        # Prevent unused variable warning\r\n        self.subscription\r\n        \r\n        # Thresholds\r\n        self.warning_threshold = 24.0\r\n        self.critical_threshold = 26.0\r\n        \r\n        # Statistics\r\n        self.max_temp = float('-inf')\r\n        self.min_temp = float('inf')\r\n        self.reading_count = 0\r\n        \r\n        self.get_logger().info('Temperature monitor started')\r\n    \r\n    def temperature_callback(self, msg):\r\n        \"\"\"Process incoming temperature message.\"\"\"\r\n        temp = msg.data\r\n        \r\n        # Update statistics\r\n        self.max_temp = max(self.max_temp, temp)\r\n        self.min_temp = min(self.min_temp, temp)\r\n        self.reading_count += 1\r\n        \r\n        # Log based on temperature\r\n        if temp >= self.critical_threshold:\r\n            self.get_logger().error(\r\n                f'CRITICAL: Temperature {temp:.2f}\xb0C exceeds threshold!'\r\n            )\r\n        elif temp >= self.warning_threshold:\r\n            self.get_logger().warn(\r\n                f'WARNING: Temperature {temp:.2f}\xb0C is high'\r\n            )\r\n        else:\r\n            self.get_logger().info(\r\n                f'Temperature: {temp:.2f}\xb0C (Normal)'\r\n            )\r\n        \r\n        # Periodic statistics report\r\n        if self.reading_count % 10 == 0:\r\n            self.get_logger().info(\r\n                f'Stats: Min={self.min_temp:.2f}\xb0C, '\r\n                f'Max={self.max_temp:.2f}\xb0C, '\r\n                f'Readings={self.reading_count}'\r\n            )\r\n\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = TemperatureMonitor()\r\n    \r\n    try:\r\n        rclpy.spin(node)\r\n    except KeyboardInterrupt:\r\n        node.get_logger().info('Shutting down...')\r\n    finally:\r\n        node.destroy_node()\r\n        rclpy.shutdown()\r\n\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,i.jsx)(r.h2,{id:"complete-code-example-3-bidirectional-communication",children:"Complete Code Example 3: Bidirectional Communication"}),"\n",(0,i.jsx)(r.p,{children:"A node that both publishes and subscribes:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:"#!/usr/bin/env python3\r\n\"\"\"\r\nTemperature Controller\r\n\r\nSubscribes to temperature, publishes control commands.\r\nImplements a simple PID controller.\r\n\"\"\"\r\n\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom std_msgs.msg import Float32\r\n\r\n\r\nclass TemperatureController(Node):\r\n    \"\"\"Controls temperature using PID algorithm.\"\"\"\r\n    \r\n    def __init__(self):\r\n        super().__init__('temperature_controller')\r\n        \r\n        # Subscriber: receive temperature readings\r\n        self.temp_subscription = self.create_subscription(\r\n            Float32,\r\n            'temperature',\r\n            self.temperature_callback,\r\n            10\r\n        )\r\n        self.temp_subscription\r\n        \r\n        # Publisher: publish control commands\r\n        self.control_publisher = self.create_publisher(\r\n            Float32,\r\n            'control_signal',\r\n            10\r\n        )\r\n        \r\n        # PID parameters\r\n        self.setpoint = 23.0  # Target temperature\r\n        self.kp = 2.0  # Proportional gain\r\n        self.ki = 0.1  # Integral gain\r\n        self.kd = 0.5  # Derivative gain\r\n        \r\n        # PID state\r\n        self.last_error = 0.0\r\n        self.integral = 0.0\r\n        self.last_time = None\r\n        \r\n        self.get_logger().info(\r\n            f'Temperature controller started (setpoint: {self.setpoint}\xb0C)'\r\n        )\r\n    \r\n    def temperature_callback(self, msg):\r\n        \"\"\"Calculate and publish control signal.\"\"\"\r\n        current_temp = msg.data\r\n        current_time = self.get_clock().now()\r\n        \r\n        # Calculate error\r\n        error = self.setpoint - current_temp\r\n        \r\n        # Calculate time delta\r\n        if self.last_time is None:\r\n            dt = 0.1  # Default\r\n        else:\r\n            dt = (current_time - self.last_time).nanoseconds / 1e9\r\n        \r\n        # PID calculation\r\n        # Proportional term\r\n        p_term = self.kp * error\r\n        \r\n        # Integral term\r\n        self.integral += error * dt\r\n        i_term = self.ki * self.integral\r\n        \r\n        # Derivative term\r\n        if dt > 0:\r\n            derivative = (error - self.last_error) / dt\r\n        else:\r\n            derivative = 0.0\r\n        d_term = self.kd * derivative\r\n        \r\n        # Total control signal\r\n        control_signal = p_term + i_term + d_term\r\n        \r\n        # Clamp control signal\r\n        control_signal = max(-100.0, min(100.0, control_signal))\r\n        \r\n        # Publish control signal\r\n        control_msg = Float32()\r\n        control_msg.data = control_signal\r\n        self.control_publisher.publish(control_msg)\r\n        \r\n        # Update state\r\n        self.last_error = error\r\n        self.last_time = current_time\r\n        \r\n        # Log\r\n        self.get_logger().info(\r\n            f'Temp: {current_temp:.2f}\xb0C, '\r\n            f'Error: {error:.2f}\xb0C, '\r\n            f'Control: {control_signal:.2f}'\r\n        )\r\n\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    node = TemperatureController()\r\n    \r\n    try:\r\n        rclpy.spin(node)\r\n    except KeyboardInterrupt:\r\n        node.get_logger().info('Shutting down...')\r\n    finally:\r\n        node.destroy_node()\r\n        rclpy.shutdown()\r\n\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,i.jsx)(r.h2,{id:"topic-inspection-commands",children:"Topic Inspection Commands"}),"\n",(0,i.jsx)(r.p,{children:"ROS 2 provides powerful command-line tools for inspecting topics:"}),"\n",(0,i.jsx)(r.h3,{id:"list-all-topics",children:"List All Topics"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-bash",children:"ros2 topic list\r\n# Output:\r\n# /control_signal\r\n# /temperature\r\n# /rosout\n"})}),"\n",(0,i.jsx)(r.h3,{id:"get-topic-information",children:"Get Topic Information"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-bash",children:"ros2 topic info /temperature\r\n# Output:\r\n# Type: std_msgs/msg/Float32\r\n# Publisher count: 1\r\n# Subscription count: 1\n"})}),"\n",(0,i.jsx)(r.h3,{id:"view-topic-data",children:"View Topic Data"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-bash",children:"# Echo topic messages\r\nros2 topic echo /temperature\r\n\r\n# Echo with specific message field\r\nros2 topic echo /temperature --field data\r\n\r\n# Echo with rate limit\r\nros2 topic echo /temperature --once\n"})}),"\n",(0,i.jsx)(r.h3,{id:"publish-to-topic",children:"Publish to Topic"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-bash",children:'# Publish once\r\nros2 topic pub /temperature std_msgs/msg/Float32 "{data: 25.0}"\r\n\r\n# Publish repeatedly\r\nros2 topic pub --rate 1 /temperature std_msgs/msg/Float32 "{data: 25.0}"\r\n\r\n# Publish with timestamp\r\nros2 topic pub /temperature std_msgs/msg/Float32 "{data: 25.0}" --once\n'})}),"\n",(0,i.jsx)(r.h3,{id:"get-topic-type",children:"Get Topic Type"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-bash",children:"ros2 topic type /temperature\r\n# Output: std_msgs/msg/Float32\n"})}),"\n",(0,i.jsx)(r.h3,{id:"monitor-topic-rate",children:"Monitor Topic Rate"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-bash",children:"ros2 topic hz /temperature\r\n# Output:\r\n# average rate: 2.000\r\n#   min: 0.500s max: 0.500s std dev: 0.00000s window: 10\n"})}),"\n",(0,i.jsx)(r.h3,{id:"view-topic-bandwidth",children:"View Topic Bandwidth"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-bash",children:"ros2 topic bw /temperature\r\n# Output:\r\n# average: 0.00 B/s\r\n#   mean: 0.00 B/s min: 0.00 B/s max: 0.00 B/s window: 10\n"})}),"\n",(0,i.jsx)(r.h2,{id:"quality-of-service-qos-profiles",children:"Quality of Service (QoS) Profiles"}),"\n",(0,i.jsx)(r.p,{children:"QoS profiles control how messages are delivered. This is crucial for reliable communication."}),"\n",(0,i.jsx)(r.h3,{id:"qos-settings",children:"QoS Settings"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:"from rclpy.qos import QoSProfile, ReliabilityPolicy, DurabilityPolicy, HistoryPolicy\r\n\r\n# Create custom QoS profile\r\nqos_profile = QoSProfile(\r\n    reliability=ReliabilityPolicy.RELIABLE,  # or BEST_EFFORT\r\n    durability=DurabilityPolicy.VOLATILE,    # or TRANSIENT_LOCAL\r\n    history=HistoryPolicy.KEEP_LAST,         # or KEEP_ALL\r\n    depth=10                                  # Queue depth\r\n)\r\n\r\n# Use in publisher\r\nself.publisher_ = self.create_publisher(\r\n    Float32,\r\n    'temperature',\r\n    qos_profile  # Use custom QoS\r\n)\n"})}),"\n",(0,i.jsx)(r.h3,{id:"common-qos-profiles",children:"Common QoS Profiles"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:"from rclpy.qos import qos_profile_sensor_data, qos_profile_default\r\n\r\n# Sensor data (best effort, small queue)\r\nself.publisher_ = self.create_publisher(\r\n    Float32,\r\n    'sensor_data',\r\n    qos_profile_sensor_data\r\n)\r\n\r\n# Default profile (reliable, volatile)\r\nself.publisher_ = self.create_publisher(\r\n    Float32,\r\n    'commands',\r\n    qos_profile_default\r\n)\n"})}),"\n",(0,i.jsx)(r.h3,{id:"qos-compatibility",children:"QoS Compatibility"}),"\n",(0,i.jsx)(r.p,{children:"Publishers and subscribers must have compatible QoS:"}),"\n",(0,i.jsxs)(r.table,{children:[(0,i.jsx)(r.thead,{children:(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.th,{children:"Publisher"}),(0,i.jsx)(r.th,{children:"Subscriber"}),(0,i.jsx)(r.th,{children:"Result"})]})}),(0,i.jsxs)(r.tbody,{children:[(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"RELIABLE"}),(0,i.jsx)(r.td,{children:"RELIABLE"}),(0,i.jsx)(r.td,{children:"\u2705 Works"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"RELIABLE"}),(0,i.jsx)(r.td,{children:"BEST_EFFORT"}),(0,i.jsx)(r.td,{children:"\u2705 Works"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"BEST_EFFORT"}),(0,i.jsx)(r.td,{children:"RELIABLE"}),(0,i.jsx)(r.td,{children:"\u274c Fails"})]}),(0,i.jsxs)(r.tr,{children:[(0,i.jsx)(r.td,{children:"BEST_EFFORT"}),(0,i.jsx)(r.td,{children:"BEST_EFFORT"}),(0,i.jsx)(r.td,{children:"\u2705 Works"})]})]})]}),"\n",(0,i.jsx)(r.h3,{id:"example-qos-configuration",children:"Example: QoS Configuration"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:"from rclpy.qos import (\r\n    QoSProfile,\r\n    ReliabilityPolicy,\r\n    DurabilityPolicy,\r\n    HistoryPolicy\r\n)\r\n\r\n# Reliable communication for critical data\r\ncritical_qos = QoSProfile(\r\n    reliability=ReliabilityPolicy.RELIABLE,\r\n    durability=DurabilityPolicy.TRANSIENT_LOCAL,\r\n    history=HistoryPolicy.KEEP_LAST,\r\n    depth=10\r\n)\r\n\r\n# Best effort for high-frequency sensor data\r\nsensor_qos = QoSProfile(\r\n    reliability=ReliabilityPolicy.BEST_EFFORT,\r\n    durability=DurabilityPolicy.VOLATILE,\r\n    history=HistoryPolicy.KEEP_LAST,\r\n    depth=5\r\n)\n"})}),"\n",(0,i.jsx)(r.h2,{id:"advanced-topics",children:"Advanced Topics"}),"\n",(0,i.jsx)(r.h3,{id:"remapping-topics",children:"Remapping Topics"}),"\n",(0,i.jsx)(r.p,{children:"Change topic names at runtime:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-bash",children:"ros2 run my_package my_node --ros-args \\\r\n  -r temperature:=/robot1/temperature\n"})}),"\n",(0,i.jsx)(r.h3,{id:"namespaces",children:"Namespaces"}),"\n",(0,i.jsx)(r.p,{children:"Organize topics with namespaces:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:"# Global topic\r\nself.publisher_ = self.create_publisher(Float32, 'temperature', 10)\r\n\r\n# Namespaced topic\r\nself.publisher_ = self.create_publisher(\r\n    Float32,\r\n    'robot1/sensors/temperature',\r\n    10\r\n)\n"})}),"\n",(0,i.jsx)(r.h3,{id:"message-filtering",children:"Message Filtering"}),"\n",(0,i.jsx)(r.p,{children:"Filter messages based on conditions:"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:"def temperature_callback(self, msg):\r\n    # Only process if temperature is significant\r\n    if abs(msg.data - self.last_temp) > 0.5:\r\n        self.process_temperature(msg.data)\r\n        self.last_temp = msg.data\n"})}),"\n",(0,i.jsx)(r.h2,{id:"common-errors-and-solutions",children:"Common Errors and Solutions"}),"\n",(0,i.jsx)(r.h3,{id:"error-1-no-subscribers-connected",children:'Error 1: "No subscribers connected"'}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Problem"}),": Publisher sends messages but no one receives them."]}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Solution"}),":"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:"# Check if subscribers exist\r\nif self.publisher_.get_subscription_count() > 0:\r\n    self.publisher_.publish(msg)\r\nelse:\r\n    self.get_logger().warn('No subscribers connected')\n"})}),"\n",(0,i.jsx)(r.h3,{id:"error-2-qos-incompatibility",children:'Error 2: "QoS incompatibility"'}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Problem"}),": Publisher and subscriber have incompatible QoS."]}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Solution"}),": Match QoS profiles or use compatible settings."]}),"\n",(0,i.jsx)(r.h3,{id:"error-3-message-queue-full",children:'Error 3: "Message queue full"'}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Problem"}),": Subscriber can't process messages fast enough."]}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Solution"}),": Increase queue size or process messages faster."]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:"# Increase queue size\r\nself.subscription = self.create_subscription(\r\n    Float32,\r\n    'temperature',\r\n    self.callback,\r\n    100  # Larger queue\r\n)\n"})}),"\n",(0,i.jsx)(r.h3,{id:"error-4-topic-name-typo",children:'Error 4: "Topic name typo"'}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Problem"}),": Publisher and subscriber use different topic names."]}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.strong,{children:"Solution"}),": Use constants or check topic names."]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:"# Define topic name as constant\r\nTEMPERATURE_TOPIC = 'temperature'\r\n\r\nself.publisher_ = self.create_publisher(Float32, TEMPERATURE_TOPIC, 10)\n"})}),"\n",(0,i.jsx)(r.h2,{id:"student-exercises",children:"Student Exercises"}),"\n",(0,i.jsx)(r.h3,{id:"exercise-1-multi-sensor-publisher",children:"Exercise 1: Multi-Sensor Publisher"}),"\n",(0,i.jsx)(r.p,{children:"Create a node that publishes data from multiple sensors (temperature, humidity, pressure) on separate topics."}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Requirements:"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Three publishers"}),"\n",(0,i.jsx)(r.li,{children:"Different publish rates for each sensor"}),"\n",(0,i.jsx)(r.li,{children:"Simulated sensor data"}),"\n"]}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Solution Template:"})}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:"class MultiSensorPublisher(Node):\r\n    def __init__(self):\r\n        super().__init__('multi_sensor_publisher')\r\n        \r\n        # Create three publishers\r\n        self.temp_pub = self.create_publisher(Float32, 'temperature', 10)\r\n        self.humidity_pub = self.create_publisher(Float32, 'humidity', 10)\r\n        self.pressure_pub = self.create_publisher(Float32, 'pressure', 10)\r\n        \r\n        # Different timers for different rates\r\n        self.create_timer(0.5, self.temp_callback)    # 2 Hz\r\n        self.create_timer(1.0, self.humidity_callback) # 1 Hz\r\n        self.create_timer(2.0, self.pressure_callback)  # 0.5 Hz\n"})}),"\n",(0,i.jsx)(r.h3,{id:"exercise-2-data-logger",children:"Exercise 2: Data Logger"}),"\n",(0,i.jsx)(r.p,{children:"Create a subscriber that logs all received messages to a file with timestamps."}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Requirements:"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Subscribe to any topic"}),"\n",(0,i.jsx)(r.li,{children:"Log to CSV file"}),"\n",(0,i.jsx)(r.li,{children:"Include timestamp and data"}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"exercise-3-topic-relay",children:"Exercise 3: Topic Relay"}),"\n",(0,i.jsx)(r.p,{children:"Create a node that subscribes to one topic and republishes on another topic (useful for topic remapping)."}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Requirements:"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:["Subscribe to ",(0,i.jsx)(r.code,{children:"/input_topic"})]}),"\n",(0,i.jsxs)(r.li,{children:["Publish to ",(0,i.jsx)(r.code,{children:"/output_topic"})]}),"\n",(0,i.jsx)(r.li,{children:"Maintain message type"}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"exercise-4-message-statistics",children:"Exercise 4: Message Statistics"}),"\n",(0,i.jsx)(r.p,{children:"Create a subscriber that calculates statistics (mean, std dev, min, max) for received messages."}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Requirements:"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Calculate running statistics"}),"\n",(0,i.jsx)(r.li,{children:"Report every N messages"}),"\n",(0,i.jsx)(r.li,{children:"Handle numeric message types"}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"exercise-5-qos-experiment",children:"Exercise 5: QoS Experiment"}),"\n",(0,i.jsx)(r.p,{children:"Create two nodes with incompatible QoS and observe the behavior. Then fix the compatibility."}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.strong,{children:"Requirements:"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"Publisher with RELIABLE QoS"}),"\n",(0,i.jsx)(r.li,{children:"Subscriber with BEST_EFFORT QoS"}),"\n",(0,i.jsx)(r.li,{children:"Document the behavior"}),"\n",(0,i.jsx)(r.li,{children:"Fix to make compatible"}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsxs)(r.ol,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Use descriptive topic names"}),": ",(0,i.jsx)(r.code,{children:"temperature_sensor"})," not ",(0,i.jsx)(r.code,{children:"temp"})]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Choose appropriate message types"}),": Use standard types when possible"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Set reasonable queue sizes"}),": Too small = dropped messages, too large = memory issues"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Match QoS profiles"}),": Ensure compatibility"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Handle errors gracefully"}),": Check for None, validate data"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Use namespaces"}),": Organize topics logically"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.strong,{children:"Document topics"}),": Use comments and README files"]}),"\n"]}),"\n",(0,i.jsx)(r.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,i.jsx)(r.p,{children:"Now that you understand nodes and topics, continue to:"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.a,{href:"/physical-ai-textbook/docs/module-01-ros2/services-actions",children:"Chapter 3: Services and Actions"})," - Learn about request-response patterns"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.a,{href:"/physical-ai-textbook/docs/module-01-ros2/python-rclpy",children:"Chapter 4: Python rclpy Deep Dive"})," - Master the Python API"]}),"\n"]})]})}function p(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,r,n)=>{n.d(r,{R:()=>l,x:()=>o});var s=n(6540);const i={},t=s.createContext(i);function l(e){const r=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function o(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),s.createElement(t.Provider,{value:r},e.children)}}}]);