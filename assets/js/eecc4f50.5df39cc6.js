"use strict";(globalThis.webpackChunkphysical_ai_textbook=globalThis.webpackChunkphysical_ai_textbook||[]).push([[2142],{8453:(n,e,r)=>{r.d(e,{R:()=>l,x:()=>o});var i=r(6540);const t={},s=i.createContext(t);function l(n){const e=i.useContext(s);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:l(n.components),i.createElement(s.Provider,{value:e},n.children)}},9867:(n,e,r)=>{r.r(e),r.d(e,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"module-02-simulation/unity-integration","title":"Chapter 5: Unity Integration","description":"Unity for Robotics","source":"@site/docs/module-02-simulation/05-unity-integration.md","sourceDirName":"module-02-simulation","slug":"/module-02-simulation/unity-integration","permalink":"/physical-ai-textbook/docs/module-02-simulation/unity-integration","draft":false,"unlisted":false,"editUrl":"https://github.com/Zeenat-Somroo911/physical-ai-textbook/edit/main/docs/module-02-simulation/05-unity-integration.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"Chapter 4: Sensor Simulation","permalink":"/physical-ai-textbook/docs/module-02-simulation/sensor-simulation"},"next":{"title":"Chapter 6: Practical Lab - Build Humanoid in Gazebo","permalink":"/physical-ai-textbook/docs/module-02-simulation/practical-lab"}}');var t=r(4848),s=r(8453);const l={sidebar_position:5},o="Chapter 5: Unity Integration",a={},c=[{value:"Unity for Robotics",id:"unity-for-robotics",level:2},{value:"Why Unity for Robotics?",id:"why-unity-for-robotics",level:3},{value:"When to Use Unity vs Gazebo",id:"when-to-use-unity-vs-gazebo",level:3},{value:"ROS-Unity Bridge",id:"ros-unity-bridge",level:2},{value:"Architecture",id:"architecture",level:3},{value:"Installation",id:"installation",level:3},{value:"Step 1: Install Unity Hub",id:"step-1-install-unity-hub",level:4},{value:"Step 2: Install Unity Editor",id:"step-2-install-unity-editor",level:4},{value:"Step 3: Install ROS-TCP-Connector",id:"step-3-install-ros-tcp-connector",level:4},{value:"Step 4: Install ROS-TCP-Endpoint (Python)",id:"step-4-install-ros-tcp-endpoint-python",level:4},{value:"Basic Setup",id:"basic-setup",level:3},{value:"Unity Side",id:"unity-side",level:4},{value:"ROS 2 Side",id:"ros-2-side",level:4},{value:"High-Fidelity Rendering",id:"high-fidelity-rendering",level:2},{value:"Rendering Features",id:"rendering-features",level:3},{value:"Camera Setup in Unity",id:"camera-setup-in-unity",level:3},{value:"Material and Lighting",id:"material-and-lighting",level:3},{value:"AR/VR Possibilities",id:"arvr-possibilities",level:2},{value:"AR Applications",id:"ar-applications",level:3},{value:"VR Applications",id:"vr-applications",level:3},{value:"AR Foundation Setup",id:"ar-foundation-setup",level:3},{value:"Complete Unity-ROS 2 Example",id:"complete-unity-ros-2-example",level:2},{value:"Unity Scene Setup",id:"unity-scene-setup",level:3},{value:"ROS 2 Control Script",id:"ros-2-control-script",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Common Pitfalls",id:"common-pitfalls",level:2},{value:"Pitfall 1: Connection Issues",id:"pitfall-1-connection-issues",level:3},{value:"Pitfall 2: Performance Issues",id:"pitfall-2-performance-issues",level:3},{value:"Pitfall 3: Coordinate Frame Mismatch",id:"pitfall-3-coordinate-frame-mismatch",level:3},{value:"Next Steps",id:"next-steps",level:2}];function d(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.header,{children:(0,t.jsx)(e.h1,{id:"chapter-5-unity-integration",children:"Chapter 5: Unity Integration"})}),"\n",(0,t.jsx)(e.h2,{id:"unity-for-robotics",children:"Unity for Robotics"}),"\n",(0,t.jsx)(e.p,{children:"Unity, primarily known for game development, has become a powerful tool for robotics simulation. With its high-fidelity rendering, physics engine, and ROS integration capabilities, Unity offers an alternative to Gazebo for certain applications."}),"\n",(0,t.jsx)(e.h3,{id:"why-unity-for-robotics",children:"Why Unity for Robotics?"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-mermaid",children:"graph TB\r\n    A[Unity Advantages] --\x3e B[High-Fidelity Graphics]\r\n    A --\x3e C[AR/VR Support]\r\n    A --\x3e D[Large Asset Library]\r\n    A --\x3e E[Cross-Platform]\r\n    A --\x3e F[ML-Agents Integration]\r\n    \r\n    style A fill:#e1f5ff\r\n    style B fill:#c8e6c9\r\n    style C fill:#fff9c4\n"})}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Key Advantages"}),":"]}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Photorealistic Rendering"}),": High-quality graphics for visual testing"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"AR/VR Support"}),": Test in virtual/augmented reality"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Asset Store"}),": Extensive library of 3D models"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"ML-Agents"}),": Built-in machine learning framework"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Cross-Platform"}),": Windows, Mac, Linux support"]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"when-to-use-unity-vs-gazebo",children:"When to Use Unity vs Gazebo"}),"\n",(0,t.jsxs)(e.table,{children:[(0,t.jsx)(e.thead,{children:(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.th,{children:"Feature"}),(0,t.jsx)(e.th,{children:"Gazebo"}),(0,t.jsx)(e.th,{children:"Unity"})]})}),(0,t.jsxs)(e.tbody,{children:[(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Physics Accuracy"}),(0,t.jsx)(e.td,{children:"Excellent"}),(0,t.jsx)(e.td,{children:"Good"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Graphics Quality"}),(0,t.jsx)(e.td,{children:"Good"}),(0,t.jsx)(e.td,{children:"Excellent"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"ROS Integration"}),(0,t.jsx)(e.td,{children:"Native"}),(0,t.jsx)(e.td,{children:"Via Bridge"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Learning Curve"}),(0,t.jsx)(e.td,{children:"Moderate"}),(0,t.jsx)(e.td,{children:"Steeper"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Cost"}),(0,t.jsx)(e.td,{children:"Free"}),(0,t.jsx)(e.td,{children:"Free (Personal)"})]}),(0,t.jsxs)(e.tr,{children:[(0,t.jsx)(e.td,{children:"Use Case"}),(0,t.jsx)(e.td,{children:"General Robotics"}),(0,t.jsx)(e.td,{children:"Visual Testing, AR/VR"})]})]})]}),"\n",(0,t.jsx)(e.h2,{id:"ros-unity-bridge",children:"ROS-Unity Bridge"}),"\n",(0,t.jsx)(e.p,{children:"The ROS-Unity bridge enables communication between Unity and ROS 2, allowing you to control Unity simulations from ROS 2 nodes and vice versa."}),"\n",(0,t.jsx)(e.h3,{id:"architecture",children:"Architecture"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-mermaid",children:"sequenceDiagram\r\n    participant ROS2\r\n    participant Bridge\r\n    participant Unity\r\n    \r\n    ROS2->>Bridge: ROS 2 Messages\r\n    Bridge->>Unity: Unity Messages\r\n    Unity->>Bridge: Sensor Data\r\n    Bridge->>ROS2: ROS 2 Topics\r\n    \r\n    Note over ROS2,Unity: Bidirectional Communication\n"})}),"\n",(0,t.jsx)(e.h3,{id:"installation",children:"Installation"}),"\n",(0,t.jsx)(e.h4,{id:"step-1-install-unity-hub",children:"Step 1: Install Unity Hub"}),"\n",(0,t.jsxs)(e.p,{children:["Download from: ",(0,t.jsx)(e.a,{href:"https://unity.com/download",children:"https://unity.com/download"})]}),"\n",(0,t.jsx)(e.h4,{id:"step-2-install-unity-editor",children:"Step 2: Install Unity Editor"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"Unity 2021.3 LTS or later recommended"}),"\n",(0,t.jsx)(e.li,{children:"Install with Linux Build Support (for ROS 2)"}),"\n"]}),"\n",(0,t.jsx)(e.h4,{id:"step-3-install-ros-tcp-connector",children:"Step 3: Install ROS-TCP-Connector"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"# Clone ROS-TCP-Connector\r\ncd ~\r\ngit clone https://github.com/Unity-Technologies/ROS-TCP-Connector.git\n"})}),"\n",(0,t.jsx)(e.h4,{id:"step-4-install-ros-tcp-endpoint-python",children:"Step 4: Install ROS-TCP-Endpoint (Python)"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-bash",children:"# Install ROS 2 dependencies\r\npip3 install rosbridge-suite\r\n\r\n# Install ROS-TCP-Endpoint\r\ncd ~/ROS-TCP-Connector/ROS-TCP-Endpoint\r\npip3 install -r requirements.txt\n"})}),"\n",(0,t.jsx)(e.h3,{id:"basic-setup",children:"Basic Setup"}),"\n",(0,t.jsx)(e.h4,{id:"unity-side",children:"Unity Side"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsx)(e.li,{children:"Create new Unity project"}),"\n",(0,t.jsx)(e.li,{children:"Import ROS-TCP-Connector package"}),"\n",(0,t.jsx)(e.li,{children:"Add ROSConnection prefab to scene"}),"\n",(0,t.jsx)(e.li,{children:"Configure connection settings"}),"\n"]}),"\n",(0,t.jsx)(e.h4,{id:"ros-2-side",children:"ROS 2 Side"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-python",children:"#!/usr/bin/env python3\r\n\"\"\"\r\nROS-Unity Bridge Example\r\n\r\nConnects to Unity and exchanges messages.\r\n\"\"\"\r\n\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom geometry_msgs.msg import Twist\r\nfrom sensor_msgs.msg import Image\r\nimport socket\r\nimport json\r\n\r\n\r\nclass UnityBridge(Node):\r\n    def __init__(self):\r\n        super().__init__('unity_bridge')\r\n        \r\n        # Connect to Unity\r\n        self.unity_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\r\n        self.unity_socket.connect(('localhost', 10000))\r\n        \r\n        # ROS 2 subscribers\r\n        self.cmd_sub = self.create_subscription(\r\n            Twist,\r\n            '/cmd_vel',\r\n            self.cmd_vel_callback,\r\n            10\r\n        )\r\n        \r\n        # ROS 2 publishers\r\n        self.image_pub = self.create_publisher(\r\n            Image,\r\n            '/unity/camera/image_raw',\r\n            10\r\n        )\r\n        \r\n        self.get_logger().info('Unity bridge connected')\r\n    \r\n    def cmd_vel_callback(self, msg):\r\n        \"\"\"Send velocity command to Unity.\"\"\"\r\n        command = {\r\n            'linear': {'x': msg.linear.x, 'y': msg.linear.y, 'z': msg.linear.z},\r\n            'angular': {'x': msg.angular.x, 'y': msg.angular.y, 'z': msg.angular.z}\r\n        }\r\n        \r\n        # Send to Unity\r\n        self.unity_socket.send(json.dumps(command).encode())\r\n    \r\n    def receive_from_unity(self):\r\n        \"\"\"Receive data from Unity.\"\"\"\r\n        data = self.unity_socket.recv(1024)\r\n        if data:\r\n            # Process Unity data\r\n            # Convert to ROS 2 message\r\n            pass\r\n\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    bridge = UnityBridge()\r\n    \r\n    try:\r\n        rclpy.spin(bridge)\r\n    except KeyboardInterrupt:\r\n        bridge.get_logger().info('Shutting down...')\r\n    finally:\r\n        bridge.unity_socket.close()\r\n        bridge.destroy_node()\r\n        rclpy.shutdown()\r\n\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,t.jsx)(e.h2,{id:"high-fidelity-rendering",children:"High-Fidelity Rendering"}),"\n",(0,t.jsx)(e.p,{children:"Unity's rendering capabilities far exceed Gazebo's, making it ideal for visual testing and computer vision applications."}),"\n",(0,t.jsx)(e.h3,{id:"rendering-features",children:"Rendering Features"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Real-Time Ray Tracing"}),": Hardware-accelerated ray tracing (RTX)"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Global Illumination"}),": Realistic lighting"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Post-Processing"}),": Bloom, depth of field, motion blur"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Shader Graph"}),": Custom visual effects"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"HDR Rendering"}),": High dynamic range"]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"camera-setup-in-unity",children:"Camera Setup in Unity"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-csharp",children:'using UnityEngine;\r\nusing RosMessageTypes.Sensor;\r\n\r\npublic class UnityCamera : MonoBehaviour\r\n{\r\n    public string topicName = "/unity/camera/image_raw";\r\n    private Camera camera;\r\n    private Texture2D texture;\r\n    \r\n    void Start()\r\n    {\r\n        camera = GetComponent<Camera>();\r\n        texture = new Texture2D(camera.pixelWidth, camera.pixelHeight);\r\n    }\r\n    \r\n    void Update()\r\n    {\r\n        // Capture camera image\r\n        RenderTexture renderTexture = camera.targetTexture;\r\n        RenderTexture.active = renderTexture;\r\n        texture.ReadPixels(new Rect(0, 0, renderTexture.width, renderTexture.height), 0, 0);\r\n        texture.Apply();\r\n        \r\n        // Convert to ROS 2 Image message\r\n        // Publish via ROS-TCP-Connector\r\n    }\r\n}\n'})}),"\n",(0,t.jsx)(e.h3,{id:"material-and-lighting",children:"Material and Lighting"}),"\n",(0,t.jsx)(e.p,{children:"Unity's material system allows for realistic surfaces:"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-csharp",children:'// Create realistic material\r\nMaterial robotMaterial = new Material(Shader.Find("Standard"));\r\nrobotMaterial.SetFloat("_Metallic", 0.5f);\r\nrobotMaterial.SetFloat("_Glossiness", 0.8f);\r\nrobotMaterial.SetColor("_Color", Color.blue);\n'})}),"\n",(0,t.jsx)(e.h2,{id:"arvr-possibilities",children:"AR/VR Possibilities"}),"\n",(0,t.jsx)(e.p,{children:"Unity's AR/VR support opens new possibilities for robotics:"}),"\n",(0,t.jsx)(e.h3,{id:"ar-applications",children:"AR Applications"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Robot Visualization"}),": Overlay robot state in real world"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Path Planning"}),": Visualize planned paths in AR"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Remote Operation"}),": Control robots through AR interface"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Training"}),": AR-based robot training"]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"vr-applications",children:"VR Applications"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Teleoperation"}),": Control robots in VR"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Training Simulators"}),": Practice in VR before real operation"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Design Review"}),": Review robot designs in VR"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Collaborative Workspaces"}),": Multiple users in shared VR space"]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"ar-foundation-setup",children:"AR Foundation Setup"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-csharp",children:"using UnityEngine;\r\nusing UnityEngine.XR.ARFoundation;\r\n\r\npublic class ARRobotController : MonoBehaviour\r\n{\r\n    private ARSessionOrigin arSessionOrigin;\r\n    private GameObject robotModel;\r\n    \r\n    void Start()\r\n    {\r\n        arSessionOrigin = FindObjectOfType<ARSessionOrigin>();\r\n        \r\n        // Spawn robot model in AR space\r\n        robotModel = Instantiate(robotPrefab);\r\n        arSessionOrigin.MakeContentAppearAt(robotModel.transform, Vector3.zero);\r\n    }\r\n    \r\n    void Update()\r\n    {\r\n        // Update robot pose from ROS 2\r\n        // Sync with AR tracking\r\n    }\r\n}\n"})}),"\n",(0,t.jsx)(e.h2,{id:"complete-unity-ros-2-example",children:"Complete Unity-ROS 2 Example"}),"\n",(0,t.jsx)(e.h3,{id:"unity-scene-setup",children:"Unity Scene Setup"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Create Scene"}),": New 3D scene"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Add Robot Model"}),": Import or create robot"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Add ROSConnection"}),": ROS-TCP-Connector prefab"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Add Camera"}),": For image capture"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Add Scripts"}),": Control and communication"]}),"\n"]}),"\n",(0,t.jsx)(e.h3,{id:"ros-2-control-script",children:"ROS 2 Control Script"}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-python",children:"#!/usr/bin/env python3\r\n\"\"\"\r\nComplete Unity-ROS 2 Integration\r\n\r\nControls Unity robot from ROS 2.\r\n\"\"\"\r\n\r\nimport rclpy\r\nfrom rclpy.node import Node\r\nfrom geometry_msgs.msg import Twist, Pose\r\nfrom sensor_msgs.msg import Image\r\nfrom std_msgs.msg import String\r\nimport socket\r\nimport json\r\nimport threading\r\n\r\n\r\nclass UnityRobotController(Node):\r\n    def __init__(self):\r\n        super().__init__('unity_robot_controller')\r\n        \r\n        # Connect to Unity\r\n        self.connect_to_unity()\r\n        \r\n        # Subscribers\r\n        self.cmd_sub = self.create_subscription(\r\n            Twist,\r\n            '/cmd_vel',\r\n            self.cmd_callback,\r\n            10\r\n        )\r\n        \r\n        self.pose_sub = self.create_subscription(\r\n            Pose,\r\n            '/target_pose',\r\n            self.pose_callback,\r\n            10\r\n        )\r\n        \r\n        # Publishers\r\n        self.image_pub = self.create_publisher(\r\n            Image,\r\n            '/unity/camera/image_raw',\r\n            10\r\n        )\r\n        \r\n        self.status_pub = self.create_publisher(\r\n            String,\r\n            '/unity/status',\r\n            10\r\n        )\r\n        \r\n        # Thread for receiving Unity data\r\n        self.receive_thread = threading.Thread(target=self.receive_loop)\r\n        self.receive_thread.start()\r\n        \r\n        self.get_logger().info('Unity robot controller started')\r\n    \r\n    def connect_to_unity(self):\r\n        \"\"\"Connect to Unity via TCP.\"\"\"\r\n        self.unity_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\r\n        try:\r\n            self.unity_socket.connect(('localhost', 10000))\r\n            self.get_logger().info('Connected to Unity')\r\n        except Exception as e:\r\n            self.get_logger().error(f'Failed to connect: {e}')\r\n    \r\n    def cmd_callback(self, msg):\r\n        \"\"\"Send velocity command to Unity.\"\"\"\r\n        command = {\r\n            'type': 'cmd_vel',\r\n            'linear': {\r\n                'x': float(msg.linear.x),\r\n                'y': float(msg.linear.y),\r\n                'z': float(msg.linear.z)\r\n            },\r\n            'angular': {\r\n                'x': float(msg.angular.x),\r\n                'y': float(msg.angular.y),\r\n                'z': float(msg.angular.z)\r\n            }\r\n        }\r\n        self.send_to_unity(command)\r\n    \r\n    def pose_callback(self, msg):\r\n        \"\"\"Send target pose to Unity.\"\"\"\r\n        pose = {\r\n            'type': 'target_pose',\r\n            'position': {\r\n                'x': float(msg.position.x),\r\n                'y': float(msg.position.y),\r\n                'z': float(msg.position.z)\r\n            },\r\n            'orientation': {\r\n                'x': float(msg.orientation.x),\r\n                'y': float(msg.orientation.y),\r\n                'z': float(msg.orientation.z),\r\n                'w': float(msg.orientation.w)\r\n            }\r\n        }\r\n        self.send_to_unity(pose)\r\n    \r\n    def send_to_unity(self, data):\r\n        \"\"\"Send JSON data to Unity.\"\"\"\r\n        try:\r\n            message = json.dumps(data) + '\\n'\r\n            self.unity_socket.send(message.encode())\r\n        except Exception as e:\r\n            self.get_logger().error(f'Failed to send: {e}')\r\n    \r\n    def receive_loop(self):\r\n        \"\"\"Receive data from Unity.\"\"\"\r\n        buffer = ''\r\n        while rclpy.ok():\r\n            try:\r\n                data = self.unity_socket.recv(4096).decode()\r\n                buffer += data\r\n                \r\n                # Process complete messages\r\n                while '\\n' in buffer:\r\n                    line, buffer = buffer.split('\\n', 1)\r\n                    if line:\r\n                        self.process_unity_message(json.loads(line))\r\n            except Exception as e:\r\n                self.get_logger().error(f'Receive error: {e}')\r\n                break\r\n    \r\n    def process_unity_message(self, data):\r\n        \"\"\"Process message from Unity.\"\"\"\r\n        msg_type = data.get('type')\r\n        \r\n        if msg_type == 'image':\r\n            # Convert to ROS 2 Image message\r\n            # Publish to /unity/camera/image_raw\r\n            pass\r\n        elif msg_type == 'status':\r\n            # Publish status\r\n            status_msg = String()\r\n            status_msg.data = data.get('status', '')\r\n            self.status_pub.publish(status_msg)\r\n\r\n\r\ndef main(args=None):\r\n    rclpy.init(args=args)\r\n    controller = UnityRobotController()\r\n    \r\n    try:\r\n        rclpy.spin(controller)\r\n    except KeyboardInterrupt:\r\n        controller.get_logger().info('Shutting down...')\r\n    finally:\r\n        controller.unity_socket.close()\r\n        controller.destroy_node()\r\n        rclpy.shutdown()\r\n\r\n\r\nif __name__ == '__main__':\r\n    main()\n"})}),"\n",(0,t.jsx)(e.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Use Unity for Visual Testing"}),": When graphics quality matters"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Use Gazebo for Physics"}),": When physics accuracy is critical"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Hybrid Approach"}),": Use both for different aspects"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Optimize Communication"}),": Minimize data transfer between Unity and ROS 2"]}),"\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.strong,{children:"Error Handling"}),": Robust connection handling"]}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"common-pitfalls",children:"Common Pitfalls"}),"\n",(0,t.jsx)(e.h3,{id:"pitfall-1-connection-issues",children:"Pitfall 1: Connection Issues"}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Problem"}),": Can't connect to Unity."]}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Solution"}),": Check firewall, port availability, and Unity ROS-TCP settings."]}),"\n",(0,t.jsx)(e.h3,{id:"pitfall-2-performance-issues",children:"Pitfall 2: Performance Issues"}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Problem"}),": Slow communication."]}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Solution"}),": Optimize message frequency, use compression, reduce data size."]}),"\n",(0,t.jsx)(e.h3,{id:"pitfall-3-coordinate-frame-mismatch",children:"Pitfall 3: Coordinate Frame Mismatch"}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Problem"}),": Robot in wrong position."]}),"\n",(0,t.jsxs)(e.p,{children:[(0,t.jsx)(e.strong,{children:"Solution"}),": Ensure consistent coordinate frames between Unity and ROS 2."]}),"\n",(0,t.jsx)(e.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,t.jsx)(e.p,{children:"Continue learning:"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:[(0,t.jsx)(e.a,{href:"/physical-ai-textbook/docs/module-02-simulation/practical-lab",children:"Chapter 6: Practical Lab"})," - Build complete humanoid simulation"]}),"\n",(0,t.jsx)(e.li,{children:"Module 3: AI-Powered Perception - Computer vision and SLAM"}),"\n"]})]})}function h(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(d,{...n})}):d(n)}}}]);